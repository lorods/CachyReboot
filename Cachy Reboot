#!/usr/bin/env -S fish --no-config
# using --no-config so fish doesn't run this script twice when it's in the initialization file and -S for multiple arguments to be parsed by env
set LATESTRECOM (grep -a -o "\[[0-9]\{4\}-[0-9]\{2\}-[0-9]\{2\}T[0-9]\{2\}:[0-9]\{2\}:[0-9]\{2\}-[0-9]\{4\}\] \[ALPM-SCRIPTLET\] ==> INFO: Reboot is recommended" /var/log/pacman.log | cut --characters 2-20 | tail -n 1)
set LASTREFRESH (last -x --since {$LATESTRECOM} | grep -E "reboot|shutdown")
if string length -q -- $LASTREFRESH
	echo "No update should require you to reboot at this moment."
else
	echo -e "You have pending updates to install. Some programs may run into unexpected issues until you reboot or shutdown and log in again.\nFor more info (and one of the reasons that prompted the creation of this script), please read https://serverfault.com/a/1098931"
end
# regex mostly generated by AI
exit 0
